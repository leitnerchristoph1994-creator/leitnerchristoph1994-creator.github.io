<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dart-Liga – Live</title>
</head>
<body>

<h2>Dart Liga – Live Ergebnisse</h2>

<div id="status">Lade Daten …</div>

<table border="1" cellpadding="6">
  <thead>
    <tr>
      <th>Team A</th>
      <th>Team B</th>
      <th>Ergebnis</th>
      <th>Aktion</th>
    </tr>
  </thead>
  <tbody id="games"></tbody>
</table>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyVShpr1NPUEDVDJ2P4XGdxz0Ae5yFs0Qb5uk2D7e8xeLwJ-145ZRd0LUaee8v_Kcyi/exec";

// feste Teams (müssen exakt zu euren Teamnamen passen!)
const teams = [
  "Team 1","Team 2","Team 3","Team 4","Team 5","Team 6",
  "Team 7","Team 8","Team 9","Team 10","Team 11","Team 12"
];

// einfacher Spielplan: jeder gegen jeden
const games = [];
for (let i = 0; i < teams.length; i++) {
  for (let j = i + 1; j < teams.length; j++) {
    games.push({ a: teams[i], b: teams[j] });
  }
}

async function loadResults() {
  const res = await fetch(API_URL);
  return await res.json();
}

async function saveResult(teamA, teamB, scoreA, scoreB) {
  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ teamA, teamB, scoreA, scoreB })
  });
}

async function render() {
  const data = await loadResults();
  const map = {};
  data.forEach(r => map[r[0] + "|" + r[1]] = r);

  const tbody = document.getElementById("games");
  tbody.innerHTML = "";

  games.forEach(g => {
    const key = g.a + "|" + g.b;
    const row = document.createElement("tr");

    const existing = map[key];
    const val = existing ? `${existing[2]}:${existing[3]}` : "";

    row.innerHTML = `
      <td>${g.a}</td>
      <td>${g.b}</td>
      <td><input value="${val}" placeholder="4:2" /></td>
      <td><button>Speichern</button></td>
    `;

    row.querySelector("button").onclick = async () => {
      const v = row.querySelector("input").value.split(":");
      if (v.length !== 2) return alert("Ungültiges Ergebnis");
      await saveResult(g.a, g.b, Number(v[0]), Number(v[1]));
      render();
    };

    tbody.appendChild(row);
  });

  document.getElementById("status").innerText = "Live – alle sehen denselben Stand";
}

render();
setInterval(render, 10000); // Auto-Refresh
</script>

</body>
</html>
