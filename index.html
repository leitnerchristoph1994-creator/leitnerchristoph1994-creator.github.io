<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dart Liga – 9 Spieler – First to 6</title>

<style>
:root {
  --bg:#0f1116;
  --card:#1a1f2b;
  --line:#2a3242;
  --text:#e8ecf3;
  --muted:#9aa3b2;
  --accent:#ff8a00;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui;
}
header{
  padding:20px;
  border-bottom:1px solid var(--line);
}
main{
  max-width:1100px;
  margin:auto;
  padding:20px;
  display:grid;
  gap:20px;
}
.card{
  background:var(--card);
  padding:16px;
  border-radius:12px;
  border:1px solid var(--line);
}
h2{margin-top:0}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:8px;
  border-bottom:1px solid var(--line);
}
input{
  width:45px;
  text-align:center;
}
button{
  padding:6px 10px;
  background:var(--accent);
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.round{
  margin-bottom:20px;
}
.pause{
  color:var(--muted);
  font-size:14px;
}
</style>
</head>

<body>

<header>
  <h1>Dart Liga – 9 Spieler – First to 6</h1>
  <div style="color:var(--muted)">
    First to 6 Legs · Kein Unentschieden · 9 Spieltage · 1 Spieler Pause pro Runde
  </div>
</header>

<main>

<div class="card">
  <h2>Spieler</h2>
  <div id="players"></div>
</div>

<div class="card">
  <h2>Tabelle</h2>
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Sp</th>
        <th>S</th>
        <th>N</th>
        <th>Pkt</th>
        <th>Legs</th>
        <th>Diff</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<div class="card">
  <h2>Spielplan</h2>
  <div id="schedule"></div>
</div>

</main>

<script>

const PLAYERS = 9;
const WIN_LEGS = 6;
const POINTS_WIN = 2;

let state = {
  players: Array.from({length:PLAYERS}, (_,i)=>`Spieler ${i+1}`),
  results: {}
};

function uid(a,b){
  return `${Math.min(a,b)}-${Math.max(a,b)}`;
}

function generateSchedule(n){
  const players = Array.from({length:n}, (_,i)=>i);
  players.push("bye"); // Dummy für Pause

  const rounds = n;
  const schedule = [];

  let arr = players.slice();

  for(let r=0;r<rounds;r++){
    const matches=[];
    for(let i=0;i<arr.length/2;i++){
      const a=arr[i];
      const b=arr[arr.length-1-i];
      if(a!=="bye" && b!=="bye"){
        matches.push([a,b]);
      }
    }
    schedule.push(matches);

    const fixed=arr[0];
    const rest=arr.slice(1);
    rest.unshift(rest.pop());
    arr=[fixed,...rest];
  }
  return schedule;
}

const schedule = generateSchedule(PLAYERS);

function renderPlayers(){
  const div=document.getElementById("players");
  div.innerHTML="";
  state.players.forEach((p,i)=>{
    const input=document.createElement("input");
    input.value=p;
    input.oninput=()=>{
      state.players[i]=input.value || `Spieler ${i+1}`;
      renderTable();
      renderSchedule();
    };
    div.appendChild(input);
    div.appendChild(document.createElement("br"));
  });
}

function isValid(a,b){
  if(a===b) return false;
  if(a<0 || b<0) return false;
  if(a>WIN_LEGS || b>WIN_LEGS) return false;
  if(a===WIN_LEGS && b<WIN_LEGS) return true;
  if(b===WIN_LEGS && a<WIN_LEGS) return true;
  return false;
}

function computeTable(){
  const stats = state.players.map((p,i)=>({
    i,
    name:p,
    played:0,
    win:0,
    loss:0,
    pts:0,
    legsFor:0,
    legsAgainst:0
  }));

  for(let key in state.results){
    const [a,b]=key.split("-").map(Number);
    const r=state.results[key];
    if(!isValid(r[a],r[b])) continue;

    stats[a].played++;
    stats[b].played++;

    stats[a].legsFor+=r[a];
    stats[a].legsAgainst+=r[b];

    stats[b].legsFor+=r[b];
    stats[b].legsAgainst+=r[a];

    if(r[a]>r[b]){
      stats[a].win++;
      stats[b].loss++;
      stats[a].pts+=POINTS_WIN;
    }else{
      stats[b].win++;
      stats[a].loss++;
      stats[b].pts+=POINTS_WIN;
    }
  }

  return stats.sort((x,y)=>{
    if(y.pts!==x.pts) return y.pts-x.pts;
    const dx=x.legsFor-x.legsAgainst;
    const dy=y.legsFor-y.legsAgainst;
    if(dy!==dx) return dy-dx;
    return y.legsFor-x.legsFor;
  });
}

function renderTable(){
  const tbody=document.getElementById("tableBody");
  tbody.innerHTML="";
  const rows=computeTable();

  rows.forEach((r,pos)=>{
    const tr=document.createElement("tr");
    const diff=r.legsFor-r.legsAgainst;
    tr.innerHTML=`
      <td>${pos+1}</td>
      <td>${r.name}</td>
      <td>${r.played}</td>
      <td>${r.win}</td>
      <td>${r.loss}</td>
      <td>${r.pts}</td>
      <td>${r.legsFor}:${r.legsAgainst}</td>
      <td>${diff>=0? "+"+diff: diff}</td>
    `;
    tbody.appendChild(tr);
  });
}

function renderSchedule(){
  const div=document.getElementById("schedule");
  div.innerHTML="";

  schedule.forEach((round,ri)=>{
    const roundDiv=document.createElement("div");
    roundDiv.className="round";
    roundDiv.innerHTML=`<h3>Spieltag ${ri+1}</h3>`;
    const playersInRound=new Set();

    round.forEach(([a,b])=>{
      playersInRound.add(a);
      playersInRound.add(b);

      const row=document.createElement("div");
      const key=uid(a,b);
      const res=state.results[key]||{};
      const as=res[a]??"";
      const bs=res[b]??"";

      row.innerHTML=`
        ${state.players[a]} 
        <input type="number" min="0" max="${WIN_LEGS}" value="${as}">
        :
        <input type="number" min="0" max="${WIN_LEGS}" value="${bs}">
        ${state.players[b]}
      `;

      const inputs=row.querySelectorAll("input");
      inputs.forEach(inp=>{
        inp.onchange=()=>{
          const n1=parseInt(inputs[0].value);
          const n2=parseInt(inputs[1].value);
          if(!isValid(n1,n2)) return;
          state.results[key]={
            [a]:n1,
            [b]:n2
          };
          renderTable();
        };
      });

      roundDiv.appendChild(row);
    });

    const pause = state.players.find((_,i)=>!playersInRound.has(i));
    const pauseDiv=document.createElement("div");
    pauseDiv.className="pause";
    pauseDiv.innerText="Pause: "+pause;
    roundDiv.appendChild(pauseDiv);

    div.appendChild(roundDiv);
  });
}

renderPlayers();
renderTable();
renderSchedule();

</script>
</body>
</html>
