<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dart Liga â€“ 9 Spieler</title>

<style>
:root{
  --bg:#0f1116;
  --card:#1c2230;
  --line:#2b3447;
  --text:#e8ecf3;
  --muted:#9aa3b2;
  --accent:#ff8a00;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui;
}
header{
  padding:18px;
  border-bottom:1px solid var(--line);
}
h1{margin:0;font-size:20px;}
main{
  max-width:700px;
  margin:auto;
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:20px;
}
.card{
  background:var(--card);
  padding:16px;
  border-radius:14px;
  border:1px solid var(--line);
}
.playerInput{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:8px;
  border:1px solid var(--line);
  background:#141925;
  color:white;
}
.matchCard{
  background:#141925;
  border:1px solid var(--line);
  border-radius:12px;
  padding:14px;
  margin-bottom:12px;
}
.matchCard .player{
  text-align:center;
  font-weight:600;
  font-size:16px;
  margin-bottom:6px;
}
.scoreRow{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:12px;
  margin:8px 0;
}
.scoreRow input{
  width:55px;
  height:45px;
  font-size:18px;
  text-align:center;
  border-radius:8px;
  border:1px solid var(--line);
  background:#0f1116;
  color:white;
}
.pause{
  text-align:center;
  color:var(--muted);
  font-size:14px;
  margin-top:8px;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}
th,td{
  padding:6px;
  border-bottom:1px solid var(--line);
  text-align:center;
}
.sectionTitle{
  font-size:18px;
  margin-bottom:10px;
}
</style>
</head>

<body>

<header>
<h1>Dart Liga â€“ 9 Spieler</h1>
<div style="color:var(--muted);font-size:14px;">
First to 6 Legs Â· Kein Unentschieden Â· 9 Spieltage
</div>
</header>

<main>

<div class="card">
<div class="sectionTitle">Spieler</div>
<div id="players"></div>
</div>

<div class="card">
<div class="sectionTitle">Tabelle</div>
<table>
<thead>
<tr>
<th>#</th>
<th>Name</th>
<th>Sp</th>
<th>Pkt</th>
<th>Diff</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<div class="card">
<div class="sectionTitle">Spielplan</div>
<div id="schedule"></div>
</div>

</main>

<script>

const STORAGE_KEY="dart_liga_mobile_v2";
const PLAYERS=9;
const WIN_LEGS=6;
const POINTS_WIN=2;

let state={
  players:Array.from({length:PLAYERS},(_,i)=>`Spieler ${i+1}`),
  results:{}
};

function save(){
  localStorage.setItem(STORAGE_KEY,JSON.stringify(state));
}

function load(){
  const raw=localStorage.getItem(STORAGE_KEY);
  if(raw){
    state=JSON.parse(raw);
  }
}

function uid(a,b){
  return `${Math.min(a,b)}-${Math.max(a,b)}`;
}

function generateSchedule(n){
  const players=[...Array(n).keys()];
  players.push("bye");
  const rounds=n;
  const schedule=[];
  let arr=players.slice();

  for(let r=0;r<rounds;r++){
    const matches=[];
    for(let i=0;i<arr.length/2;i++){
      const a=arr[i];
      const b=arr[arr.length-1-i];
      if(a!=="bye"&&b!=="bye") matches.push([a,b]);
    }
    schedule.push(matches);
    const fixed=arr[0];
    const rest=arr.slice(1);
    rest.unshift(rest.pop());
    arr=[fixed,...rest];
  }
  return schedule;
}

const schedule=generateSchedule(PLAYERS);

function isValid(a,b){
  if(a===b) return false;
  if(a<0||b<0) return false;
  if(a>WIN_LEGS||b>WIN_LEGS) return false;
  if(a===WIN_LEGS&&b<WIN_LEGS) return true;
  if(b===WIN_LEGS&&a<WIN_LEGS) return true;
  return false;
}

function renderPlayers(){
  const div=document.getElementById("players");
  div.innerHTML="";
  state.players.forEach((p,i)=>{
    const input=document.createElement("input");
    input.className="playerInput";
    input.value=p;
    input.oninput=()=>{
      state.players[i]=input.value||`Spieler ${i+1}`;
      save();
      renderTable();
      renderSchedule();
    };
    div.appendChild(input);
  });
}

function computeTable(){
  const stats=state.players.map((p,i)=>({
    i,name:p,played:0,pts:0,legsFor:0,legsAgainst:0
  }));

  for(let key in state.results){
    const [a,b]=key.split("-").map(Number);
    const r=state.results[key];
    if(!isValid(r[a],r[b])) continue;

    stats[a].played++;
    stats[b].played++;
    stats[a].legsFor+=r[a];
    stats[a].legsAgainst+=r[b];
    stats[b].legsFor+=r[b];
    stats[b].legsAgainst+=r[a];

    if(r[a]>r[b]) stats[a].pts+=POINTS_WIN;
    else stats[b].pts+=POINTS_WIN;
  }

  return stats.sort((x,y)=>{
    if(y.pts!==x.pts) return y.pts-x.pts;
    const dx=x.legsFor-x.legsAgainst;
    const dy=y.legsFor-y.legsAgainst;
    return dy-dx;
  });
}

function renderTable(){
  const tbody=document.getElementById("tableBody");
  tbody.innerHTML="";
  const rows=computeTable();
  rows.forEach((r,pos)=>{
    const diff=r.legsFor-r.legsAgainst;
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${pos+1}</td>
      <td>${r.name}</td>
      <td>${r.played}</td>
      <td>${r.pts}</td>
      <td>${diff>=0? "+"+diff: diff}</td>
    `;
    tbody.appendChild(tr);
  });
}

function renderSchedule(){
  const div=document.getElementById("schedule");
  div.innerHTML="";
  schedule.forEach((round,ri)=>{
    const roundTitle=document.createElement("h3");
    roundTitle.innerText="Spieltag "+(ri+1);
    div.appendChild(roundTitle);

    const used=new Set();

    round.forEach(([a,b])=>{
      used.add(a); used.add(b);
      const key=uid(a,b);
      const res=state.results[key]||{};
      const as=res[a]??"";
      const bs=res[b]??"";

      const card=document.createElement("div");
      card.className="matchCard";

      card.innerHTML=`
        <div class="player">${state.players[a]}</div>
        <div class="scoreRow">
          <input type="number" min="0" max="${WIN_LEGS}" value="${as}">
          <div>:</div>
          <input type="number" min="0" max="${WIN_LEGS}" value="${bs}">
        </div>
        <div class="player">${state.players[b]}</div>
      `;

      const inputs=card.querySelectorAll("input");

      inputs.forEach(inp=>{
        inp.onchange=()=>{
          const v1=inputs[0].value;
          const v2=inputs[1].value;

          // ðŸ”¥ LÃ¶schen wenn beide leer
          if(v1==="" && v2===""){
            delete state.results[key];
            save();
            renderTable();
            return;
          }

          const n1=parseInt(v1);
          const n2=parseInt(v2);

          if(!isValid(n1,n2)) return;

          state.results[key]={[a]:n1,[b]:n2};
          save();
          renderTable();
        };
      });

      div.appendChild(card);
    });

    const pause=state.players.find((_,i)=>!used.has(i));
    const pauseDiv=document.createElement("div");
    pauseDiv.className="pause";
    pauseDiv.innerText="Pause: "+pause;
    div.appendChild(pauseDiv);
  });
}

load();
renderPlayers();
renderTable();
renderSchedule();

</script>
</body>
</html>
